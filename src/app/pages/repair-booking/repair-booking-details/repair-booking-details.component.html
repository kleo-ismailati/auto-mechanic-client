<div class="bg-light">
  <app-breadcrumb [parentsList]="breadcrumbParentsList" [currentPage]="'Details'">
  </app-breadcrumb>
  <div class="container crumb-container-no-banner">
    <div class="container card my-2 py-2" *ngIf="this.data">
      <div class="row">
        <h1 class="lead fw-bold text-center">Booking Details</h1>
      </div>
      <div class="row">
        <table class="table table-bordered w-75 mx-auto">
          <tbody>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Client</td>
            <td>{{this.data.client?.firstName}} {{this.data.client?.lastName}}</td>
          </tr>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Car</td>
            <td>{{this.data.car?.carModel}} {{this.data.car?.carType}}</td>
          </tr>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Full repair cost</td>
            <td>{{this.data.totalPrice | currency:'USD'}}</td>
          </tr>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Booking date</td>
            <td>{{this.data.date | date}}</td>
          </tr>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Repair status</td>
            <td *ngIf="!isEdit">{{repairStatus[this.data.status]}}</td>
            <select *ngIf="isEdit" [(ngModel)] = "this.data.status" class="form-select" aria-label="Set status">
              <option *ngFor="let symbol of repairStatusKeys" [value]="symbol"
                      [selected]="this.data.status == symbol">
                {{repairStatus[symbol]}}
              </option>
            </select>
          </tr>
          </tbody>
        </table>
      </div>
      <div class="row mx-auto my-2 w-75">
        <div class="d-flex justify-content-end">
          <button *ngIf="(!isEdit&&!addingNewRepair)" class="btn btn-outline-primary me-2" (click)="addRepair()">Add Repair</button>
          <button *ngIf="!isEdit" class="btn btn-outline-success me-2" (click)="enableEdit()">Edit Booking</button>
          <button *ngIf="isEdit" class="btn btn-success me-2" (click)="submit()">Save</button>
          <a routerLink="../../">
            <button class="btn btn-outline-secondary">
              Back
            </button>
          </a>
        </div>
      </div>
      <div *ngIf="addingNewRepair" class="row mx-auto my-2 w-75 card p-2">
        <div class="card-title"><h1 class="lead fw-bold text-center">New Repair</h1></div>
        <div class="form-group col">
          <label for="repairType">Repair Type</label>
          <input [(ngModel)]="newRepair.repairType" type="text" class="form-control" id="repairType" name="repairType">
        </div>
        <div class="form-group col">
          <label>Repair Cost</label>
          <input [(ngModel)]="newRepair.repairCost" type="number" class="form-control">
        </div>
        <div class="form-group">
          <label>Repair Details</label>
          <textarea [(ngModel)]="newRepair.repairDetails" type="text" rows="2" class="form-control"></textarea>
        </div>

        <div class="d-flex justify-content-end mt-2">
          <button  class="btn btn-success me-2" (click)="submitNewRepair()">Add</button>
          <button  class="btn btn-secondary me-2" (click)="cancelNewRepair()">Cancel</button>
        </div>
      </div>
      <h1 class="lead fw-bold text-center">List of repairs</h1>
      <div class="row" *ngFor="let repair of this.data.repairs; let i = index">
        <table class="table table-bordered w-75 mx-auto">
          <thead class="table-light">
          <tr>
            <th class="fw-bold col-sm-2 text-end">Repair #{{i+1}}</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Repair type</td>
            <td *ngIf="!isRepairEdit(repair.id)">{{repair.repairType}}</td>
            <input *ngIf="isRepairEdit(repair.id)" [(ngModel)]="repair.repairType"
                   type="text" class="form-control" aria-label="Repair Type">
          </tr>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Repair details</td>
            <td *ngIf="!isRepairEdit(repair.id)">{{repair.repairDetails}}</td>
            <input *ngIf="isRepairEdit(repair.id)" [(ngModel)]="repair.repairDetails"
                   type="text" class="form-control" aria-label="Repair Details">
          </tr>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Repair cost</td>
            <td *ngIf="!isRepairEdit(repair.id)">{{repair.repairCost | currency:'USD'}}</td>
            <input *ngIf="isRepairEdit(repair.id)" [(ngModel)]="repair.repairCost"
                   type="number" class="form-control" aria-label="Repair Cost">
          </tr>
          <tr>
            <td class="fw-bold col-sm-2 text-end">Repair status</td>
            <td *ngIf="!isRepairEdit(repair.id)">{{repairStatus[repair.repairStatus]}}</td>
            <select *ngIf="isRepairEdit(repair.id)" [(ngModel)] = "repair.repairStatus" class="form-select" aria-label="Set status">
              <option *ngFor="let symbol of repairStatusKeys" [value]="symbol"
                      [selected]="repair.repairStatus == symbol">
                {{repairStatus[symbol]}}
              </option>
            </select>
          </tr>
          </tbody>
        </table>

        <div class="mx-auto my-2 w-75">
          <div class="d-flex justify-content-end">
            <button *ngIf="!isRepairEdit(repair.id)" class="btn btn-outline-success me-2" (click)="enableRepairEdit(repair.id)">Edit Repair</button>
            <button *ngIf="!isRepairEdit(repair.id)" class="btn btn-outline-danger me-2" (click)="deleteRepair(repair.id)">Delete Repair</button>
            <button *ngIf="isRepairEdit(repair.id)" class="btn btn-success me-2" (click)="submitRepair(repair)">Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

